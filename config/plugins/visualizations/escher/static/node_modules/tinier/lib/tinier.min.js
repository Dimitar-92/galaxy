"use strict";function noop(){}function constant(e){return function(){return e}}function identity(e){return e}function last(e){return e[e.length-1]}function tail(e){return[e.slice(0,-1),last(e)]}function head(e){return[e[0],e.slice(1)]}function fromPairs(e){return e.reduce(function(e,n){var t,r=n[0],i=n[1];return _extends({},e,(t={},t[r]=i,t))},{})}function get(e,n){return e&&"string"!=typeof e&&e.hasOwnProperty(n)?e[n]:null}function isUndefined(e){return"undefined"==typeof e}function isObject(e){return null!=e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))}function isArray(e){return Array.isArray(e)}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isBoolean(e){return"boolean"==typeof e}function isFunction(e){return"function"==typeof e}function notNull(e){return null!==e}function mapValues(e,n){var t={};for(var r in e)t[r]=n(e[r],r);return t}function reduceValues(e,n,t){var r=t;for(var i in e)r=n(r,e[i],i);return r}function zipArrays(e){for(var n=Math.max.apply(null,e.filter(function(e){return null!==e}).map(function(e){return e.length})),t=[],r=function(n){t.push(e.map(function(e){return null!==e&&n<e.length?e[n]:null}))},i=0;i<n;i++)r(i);return t}function zipObjects(e){for(var n=e.length,t={},r=0;r<n;r++){var i=e[r];if(null!==i)for(var o in i)t[o]=!0}var a={};for(var l in t){a[l]=Array(n);for(var u=0;u<n;u++){var s=e[u];a[l][u]=get(s,l)}}return a}function filterValues(e,n){var t={};for(var r in e){var i=e[r];n(i,r)&&(t[r]=i)}return t}function any(e){for(var n=0,t=e.length;n<t;n++){var r=e[n];if(!isBoolean(r))throw new Error("Not a boolean: "+r);if(r)return!0}return!1}function defer(e){setTimeout(e,1)}function tagType(e,n){if(!isString(e))throw new Error("First argument must be a string");if(!isObject(n))throw new Error("Second argument must be an object");return n.type=e,n}function checkType(e,n){if(null===n)return e===NULL;if("string"!=typeof e)throw new Error("First argument must be a string");if(isUndefined(n))throw new Error("Bad second argument");return get(n,"type")===e}function match(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:throwUnrecognizedType;for(var r in n)if(r===NULL&&null===e||r===ARRAY&&isArray(e)||isObject(e)&&checkType(r,e))return n[r](e);return OBJECT in n&&isObject(e)?n[OBJECT](e):t(e)}function throwUnrecognizedType(e){throw new Error("Unrecognized type in pattern matching: "+e)}function hasChildren(e){var n;return match(e,(n={},n[ARRAY_OF]=function(){return!0},n[OBJECT_OF]=function(){return!0},n[COMPONENT]=function(){return!0},n[ARRAY]=function(e){return any(e.map(hasChildren))},n[OBJECT]=function(e){return any(Object.keys(e).map(function(n){return hasChildren(e[n])}))},n))}function checkRenderResultRecurse(e,n,t){var r,i=function(t,r){var i=null===r?e:get(e,r);if(null!==e&&null===i)throw new Error("Shape of the bindings object does not match the model.Model: "+n+"  Bindings object: "+e)},o=function(n,r){checkRenderResultRecurse(get(e,r),n,get(t,r))};match(n,(r={},r[OBJECT_OF]=function(r){if(null!==e&&any(Object.keys(e).map(function(e){return!(e in t)})))throw new Error("Shape of the bindings object does not match the model. Model: "+n+" Bindings object: "+e);mapValues(t,i)},r[ARRAY_OF]=function(r){if(null!==e&&t.length!==e.length)throw new Error("Shape of the bindings object does not match the model. Model: "+n+" Bindings object: "+e);t.map(i)},r[COMPONENT]=function(e){return i(t,null)},r[ARRAY]=function(t){if(null!==e&&!isArray(e))throw new Error("Shape of the bindings object does not match the model. Model: "+n+" Bindings object: "+e);t.map(o)},r[OBJECT]=function(t){if(null!==e&&isArray(e))throw new Error("Shape of the bindings object does not match the model. Model: "+n+" Bindings object: "+e);mapValues(t,o)},r))}function checkRenderResult(e,n,t){return checkRenderResultRecurse(e,n,t),e}function updateEl(e,n,t,r,i,o,a,l){var u=patchReducersWithState(e,n,a.callReducer),s=patchSignals(e,n,a.callSignal),c=patchMethods(e,n,a.callMethod,u,s),d={state:t,methods:c,reducers:u,signals:s,el:o,lastRenderedEl:i};if(null===o&&r!==DESTROY&&n.render!==noop)throw new Error("No binding provided for component "+n.displayName+" at ["+e.join(", ")+"].");if(r===DESTROY)return n.willUnmount(d),{bindings:null,lastRenderedEl:i};var f=r===CREATE||r===UPDATE||o!==i;r===CREATE?n.willMount(d):f&&n.willUpdate(d),l.verbose&&f&&console.log("Rendering "+n.displayName+" at ["+e.join(", ")+"].");var p=f?checkRenderResult(n.render(d),n.model,t):null;if(f&&null===p&&hasChildren(n.model))throw new Error("The render function of component "+n.displayName+" did not return new bindings");return r===CREATE?defer(function(){return n.didMount(d)}):f&&defer(function(){return n.didUpdate(d)}),{bindings:p,lastRenderedEl:f?o:i}}function dropNodes(e){var n;return match(e,(n={},n[NODE]=function(e){return e.data},n[OBJECT]=function(e){return mapValues(e,dropNodes)},n[ARRAY]=function(e){return e.map(dropNodes)},n[NULL]=function(){return null},n))}function updateComponents(e,n,t,r,i,o,a,l){var u,s=function(t,r){var u=t[0],s=t[1],c=null!==r?n.component:n,d=null!==r?addressWith(e,r):e,f=null!==r?get(i,r):i,p=null!==r?get(o,r):o,h=updateEl(d,c,s,u.data,get(f,"data"),p,a,l),m=null!==h.bindings?h.bindings:dropNodes(f.children),g=h.lastRenderedEl,E=updateComponents(d,c.model,s,u.children,get(f,"children"),m,a,l);return tagType(NODE,{data:g,children:E})},c=function(n,u){return updateComponents(addressWith(e,u),n,get(t,u),r[u],get(i,u),get(o,u),a,l)};return match(n,(u={},u[OBJECT_OF]=function(e){return mapValues(zipObjects([r,t]),s)},u[ARRAY_OF]=function(e){return zipArrays([r,t]).map(s)},u[COMPONENT]=function(e){return s([r,t],null)},u[ARRAY]=function(e){return e.map(c)},u[OBJECT]=function(e){return mapValues(e,c)},u))}function addressWith(e,n){if(null===n)return e;var t=e.slice(0);return t.push(n),t}function addressEqual(e,n){return null!==e&&null!==n&&e.length===n.length&&e.reduce(function(e,t,r){return e&&t===n[r]},!0)}function treeGet(e,n){return e.reduce(function(e,n){return checkType(NODE,e)?e.children[n]:e[n]},n)}function treeSet(e,n,t){if(0===e.length)return t;var r,i=head(e),o=i[0],a=i[1];return"string"==typeof o?_extends({},n,(r={},r[o]=treeSet(a,treeGet([o],n),t),r)):[].concat(n.slice(0,o),[treeSet(a,treeGet([o],n),t)],n.slice(o+1))}function treeSetMutable(e,n,t){if(0===e.length)return t;var r=tail(e),i=r[0],o=r[1],a=treeGet(i,n);return checkType(NODE,a)?a.children[o]=t:a[o]=t,n}function makeTree(e,n){var t=e;return{get:function(e){return treeGet(e,t)},set:function(e,r){t=n?treeSetMutable(e,t,r):treeSet(e,t,r)}}}function checkState(e,n){var t;null!==n&&match(e,(t={},t[OBJECT_OF]=function(t){if(!isObject(n)||isArray(n))throw new Error("Shape of the new state does not match the model. Model: "+t+"  State: "+n);mapValues(n,function(n){return checkState(e.component.model,n)})},t[ARRAY_OF]=function(t){if(!isArray(n))throw new Error("Shape of the new state does not match the model.Model: "+t+"  State: "+n);n.map(function(n){return checkState(e.component.model,n)})},t[COMPONENT]=function(t){checkState(e.model,n)},t[ARRAY]=function(e){if(!isArray(n))throw new Error("Shape of the new state does not match the model.Model: "+e+"  State: "+n);e.map(function(e,t){return checkState(e,get(n,t))})},t[OBJECT]=function(e){if(!isObject(n)||isArray(n))throw new Error("Shape of the new state does not match the model. Model: "+e+"  State: "+n);mapValues(e,function(e,t){return checkState(e,get(n,t))})},t))}function computeDiffValue(e,n,t,r,i,o,a){var l=r(e,t),u=r(n,t);if(l&&!u)return CREATE;if(l&&u){var s=null===t?e!==n:e[t]!==n[t],c=addressEqual(o,a);return s&&i({state:e,lastState:n,componentTriggeredUpdate:c})?UPDATE:null}return!l&&u?DESTROY:null}function diffWithModel(e,n,t,r,i){var o;return match(e,(o={},o[OBJECT_OF]=function(e){var o=function(e,n){return isObject(e)&&n in e&&null!==e[n]},a=Object.assign({},n||{},t||{});return mapValues(a,function(a,l){var u=computeDiffValue(n,t,l,o,e.component.shouldUpdate,addressWith(r,l),i),s=diffWithModel(e.component.model,get(n,l),get(t,l),addressWith(r,l),i);return tagType(NODE,{data:u,children:s})})},o[ARRAY_OF]=function(e){var o=function(e,n){return isArray(e)&&n<e.length&&null!==e[n]},a=Math.max(isArray(n)?n.length:0,isArray(t)?t.length:0),l=Array.apply(null,{length:a});return l.map(function(a,l){var u=computeDiffValue(n,t,l,o,e.component.shouldUpdate,addressWith(r,l),i),s=diffWithModel(e.component.model,get(n,l),get(t,l),addressWith(r,l),i);return tagType(NODE,{data:u,children:s})})},o[COMPONENT]=function(e){var o=function(e,n){return null!==e},a=computeDiffValue(n,t,null,o,e.shouldUpdate,r,i),l=diffWithModel(e.model,n||null,t||null,r,i);return tagType(NODE,{data:a,children:l})},o[ARRAY]=function(e){return e.map(function(e,o){return diffWithModel(e,get(n,o),get(t,o),addressWith(r,o),i)})},o[OBJECT]=function(e){return mapValues(e,function(e,o){return diffWithModel(e,get(n,o),get(t,o),addressWith(r,o),i)})},o))}function singleOrAll(e,n,t){var r=function(r){return 0===r.length?null:1===i.signals.length?{minSignals:{diff:t.map(function(e){return e.minSignals.diff}),address:n,modelNode:e},minUpdate:{diff:t.map(function(e){return e.minUpdate.diff}),address:n,modelNode:e}}:{minSignals:{diff:t.map(function(e){return e.minSignals.diff}),address:n,modelNode:e},minUpdate:{diff:t.map(function(e){return e.minUpdate.diff}),address:n,modelNode:e}}},i=t.reduce(function(e,n,t){return{signals:null!==n.minSignals?[].concat(e.signals,[t]):e.signals,update:null!==n.minUpdate?[].concat(e.update,[t]):e.update}},{signals:[],update:[]}),o=r(i.signals),a=r(i.update);return{minSignals:o,minUpdate:a}}function diffWithModelMin(e,n,t,r,i){var o=diffWithModel(e,n,t,r,i);return{minSignals:{diff:o,address:r,modelNode:e},minUpdate:{diff:o,address:r,modelNode:e}}}function makeSignal(){var e={_onFns:[]};return e.on=function(n){if(!isFunction(n))throw new Error('First argument to "on" must be a function');e._onFns=[].concat(e._onFns,[n])},e.call=function(){for(var n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];return e._onFns.map(function(e){return e.apply(void 0,t)})},e}function makeOneSignalAPI(e){var n={_callFns:[]};n.call=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(t.length>1||!isObject(t[0]))throw new Error("Call only accepts a single object as argument.");n._callFns.map(function(e){var n=e.fn;return n(t[0])})},n._onFns=[];var t=e?"onEach":"on";return n[t]=function(e){if(!isFunction(e))throw new Error('Argument to "'+t+'" must be a function');n._onFns.push(function(n){return function(){if(arguments.length>1||!isObject(arguments.length<=0?void 0:arguments[0]))throw new Error("On function only accepts a single object as argument.");var t="string"==typeof n?_extends({k:n},arguments.length<=0?void 0:arguments[0]):"number"==typeof n?_extends({i:n},arguments.length<=0?void 0:arguments[0]):arguments.length<=0?void 0:arguments[0];e(t)}})},n}function makeSignalsAPI(e,n){return fromPairs(e.map(function(e){return[e,makeOneSignalAPI(n)]}))}function makeChildSignalsAPI(e){var n;return match(e,(n={},n[OBJECT_OF]=function(e){return makeSignalsAPI(e.component.signalNames,!0)},n[ARRAY_OF]=function(e){return makeSignalsAPI(e.component.signalNames,!0)},n[COMPONENT]=function(e){return makeSignalsAPI(e.signalNames,!1)},n[ARRAY]=function(e){return e.map(makeChildSignalsAPI).filter(notNull)},n[OBJECT]=function(e){return filterValues(mapValues(e,makeChildSignalsAPI),notNull)},n),constant(null))}function reduceChildren(e,n,t){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return match(e,(r={},r[NODE]=function(e){return n(t,e.data,i)},r[ARRAY]=function(e){return e.reduce(function(e,t,r){return reduceChildren(t,n,e,addressWith(i,r))},t)},r[OBJECT]=function(e){return reduceValues(e,function(e,t,r){return reduceChildren(t,n,e,addressWith(i,r))},t)},r),constant(t))}function runSignalSetup(e,n,t){var r=makeSignalsAPI(e.signalNames,!1),i=makeChildSignalsAPI(e.model),o=patchReducersWithState(n,e,t.callReducer),a=patchSignals(n,e,t.callSignal),l=patchMethods(n,e,t.callMethod,o,a);return e.signalSetup({methods:l,reducers:o,signals:r,childSignals:i}),{signalsAPI:r,childSignalsAPI:i}}function mergeSignals(e,n,t,r,i){var o,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=function(t,r){var o=t[0],u=t[1],s=null!==r?e.component:e,c=null!==r?addressWith(n,r):n,d=o.data;if(d!==CREATE){if(d===DESTROY)return null;var f=reduceChildren(o.children,function(e,n,t){var r=e.hasCreated||n===CREATE,i=n===DESTROY?[].concat(e.destroyed,[t]):e.destroyed;return{hasCreated:r,destroyed:i}},{hasCreated:!1,destroyed:[]}),p=f.hasCreated,h=f.destroyed;h.map(function(e){var n=e.reduce(function(n,t,r){if(t in n)return n[t];if(r===e.length-1)return n;throw new Error("Bad address "+e+" for object "+u.data.childSignalsAPI)},u.data.childSignalsAPI);mapValues(n,function(n){n._callFns=n._callFns.filter(function(n){var t=n.address;return!addressEqual(t,e)})})});var m=p?u.data.childSignalsAPI:null,g=p?[]:null,E=mergeSignals(s.model,c,o.children,get(u,"children"),i,m,g);return tagType(NODE,{data:get(u,"data"),children:E})}var T=function(){var e=runSignalSetup(s,c,i),n=e.signalsAPI,t=e.childSignalsAPI,d=null===l?null:addressWith(l,r),f=mapValues(zipObjects([n,a]),function(e,n){var t=e[0],i=e[1],o=makeSignal();return t._onFns.map(function(e){return o.on(e())}),t._callFns=[{fn:o.call,address:null}],null!==i&&(i._onFns.map(function(e){return o.on(e(r))}),i._callFns=[].concat(i._callFns,[{fn:o.call,address:d}])),o}),p={signals:f,signalsAPI:n,childSignalsAPI:t},h=mergeSignals(s.model,c,o.children,get(u,"children"),i,t,[]);return{v:tagType(NODE,{data:p,children:h})}}();if("object"===("undefined"==typeof T?"undefined":_typeof(T)))return T.v},s=function(e,t){var r=e[0],o=e[1],a=e[2],u=e[3],s=addressWith(n,t),c=null===l?null:addressWith(l,t);return mergeSignals(r,s,o,a,i,u,c)};return match(e,(o={},o[OBJECT_OF]=function(e){return filterValues(mapValues(zipObjects([t,r]),u),notNull)},o[ARRAY_OF]=function(e){return zipArrays([t,r]).map(u).filter(notNull)},o[COMPONENT]=function(e){return u([t,r],null)},o[ARRAY]=function(e){return zipArrays([e,t,r,a]).map(s)},o[OBJECT]=function(e){return mapValues(zipObjects([e,t,r,a]),s)},o),constant(null))}function objectOf(e){return tagType(OBJECT_OF,{component:e})}function arrayOf(e){return tagType(ARRAY_OF,{component:e})}function defaultShouldUpdate(e){var n=e.state,t=e.lastState;return n!==t}function checkInputs(e,n){mapValues(e,function(e,t){t in n||console.error("Unexpected argument "+t)})}function patchInitNoArg(e){return function(){if(0===arguments.length)return e({});if(arguments.length>1||!isObject(arguments.length<=0?void 0:arguments[0]))throw new Error("Reducers can only take 1 or 0 arguments, and the argument should be an object.");return e(arguments.length<=0?void 0:arguments[0])}}function patchReducersOneArg(e){return mapValues(e,function(e,n){return function(){if(1===arguments.length&&isObject(arguments.length<=0?void 0:arguments[0])){if("state"in(arguments.length<=0?void 0:arguments[0]))return e(arguments.length<=0?void 0:arguments[0]);throw new Error('The argument to the reducer must have a "state" attribute.')}throw new Error("Reducers can only take 1 arguments, and the argument should be an object.")}})}function createComponent(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n={displayName:"",signalNames:[],signalSetup:noop,model:{},init:constant({}),reducers:{},methods:{},willMount:noop,didMount:noop,shouldUpdate:defaultShouldUpdate,willUpdate:noop,didUpdate:noop,willUnmount:noop,render:noop};if(checkInputs(e,n),"init"in e&&(e.init=patchInitNoArg(e.init)),"reducers"in e&&(e.reducersRaw=e.reducers,e.reducers=patchReducersOneArg(e.reducers)),e.model&&checkType(COMPONENT,e.model))throw new Error("The model cannot be another Component. The top level of the model should be an array or an object literal");return tagType(COMPONENT,_extends({},n,e))}function patchReducersWithState(e,n,t){return mapValues(n.reducersRaw,function(r,i){return function(){if(0===arguments.length)t(e,n,r,{},i);else{if(arguments.length>1||!isObject(arguments.length<=0?void 0:arguments[0]))throw new Error("Reducers can only take 1 or 0 arguments, and the argument should be an object.");t(e,n,r,arguments.length<=0?void 0:arguments[0],i)}}})}function patchSignals(e,n,t){return fromPairs(n.signalNames.map(function(n){return[n,{call:function(r){return t(e,n,r)}}]}))}function patchMethods(e,n,t,r,i){var o=mapValues(n.methods,function(n){return function(a){"undefined"!=typeof Event&&a instanceof Event?t(e,n,i,o,r,this,a,{}):t(e,n,i,o,r,null,null,a)}});return o}function makeCallMethod(e,n){return function(n,t,r,i,o,a,l,u){if(null===e.get([]))throw new Error("Cannot call method before the app is initialized (e.g. in signalSetup).");var s=e.get(n);t(_extends({state:s,signals:r,methods:i,reducers:o,target:a,event:l},u))}}function makeCallSignal(e,n){return function(t,r,i){n.verbose&&console.log("Called signal "+r+" at ["+t.join(", ")+"]."),e.get(t).data.signals[r].call(i)}}function makeCallReducer(e,n,t,r,i,o){return function(a,l,u,s,c){if(!isFunction(u))throw new Error("Reducer "+c+" is not a function");var d=n.get(a),f=u(_extends({},s,{state:d}));o.verbose&&(console.log("Called reducer "+c+" for "+l.displayName+" at ["+a.join(", ")+"]."),console.log(d),console.log(f)),checkState(l.model,f);var p=n.get([]);n.set(a,f);var h=diffWithModelMin(e,n.get([]),p,[],a),m=h.minSignals,g=h.minUpdate,E=r.get(m.address),T=mergeSignals(m.modelNode,m.address,m.diff,E,i);r.set(m.address,T);var A=t.get(g.address),O=A.data,N=n.get(g.address),v=updateComponents(g.address,g.modelNode,N,g.diff,A,O,i,o);t.set(g.address,v)}}function makeStateCallers(e,n,t,r,i){var o={};return o.callMethod=makeCallMethod(n,i),o.callSignal=makeCallSignal(r,i),o.callReducer=makeCallReducer(e,n,t,r,o,i),o}function run(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=makeTree(null,!1),i=tagType(NODE,{data:n,children:null}),o=makeTree(i,!0),a=makeTree(null,!0),l=makeStateCallers(e,r,o,a,t),u="initialState"in t?t.initialState:e.init(),s=function(e){var n=e.newState;return n},c=function(n){return l.callReducer([],e,s,{newState:n},"setState")};c(u);var d=function(){return r.get([])},f=function(e){return r.set([],e)},p=patchReducersWithState([],e,l.callReducer),h=patchSignals([],e,l.callSignal),m=patchMethods([],e,l.callMethod,p,h),g=get(a.get([]).data,"signals");return{setState:c,setStateNoRender:f,getState:d,reducers:p,methods:m,signals:g}}function reverseObject(e){var n={};for(var t in e)n[e[t]]=t;return n}function keyBy(e,n){var t={};return e.map(function(e){return t[e[n]]=e}),t}function addressToObj(e,n){if(isUndefined(e[0]))return n;var t=e[0];if(isString(t)){var r;return r={},r[t]=addressToObj(e.slice(1),n),r}var i=Array(t+1);return i[t]=addressToObj(e.slice(1),n),i}function objectForBindingsArray(e){for(var n=0,t=0,r=e.length;t<r;t++){var i=e[t];if(!isArray(i))throw Error("Incompatible bindings: mix of types");var o=i.length;o>n&&(n=o)}for(var a=[],l=0;l<n;l++)for(var u=0,s=e.length;u<s;u++){var c=e[u];null!=c[l]&&(null!=a[l]?a[l]=objectForBindings([c[l],a[l]]):a[l]=c[l])}return a}function objectForBindingsObject(e){return e.reduce(function(e,n){if(isArray(n))throw Error("Incompatible bindings: mix of types");for(var t in n)n[t]&&(e[t]?e[t]=objectForBindings([n[t],e[t]]):e[t]=n[t]);return e},{})}function objectForBindings(e){return isArray(e[0])?objectForBindingsArray(e):objectForBindingsObject(e)}function isElement(e){return e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}function isText(e){return e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))&&null!==e&&3===e.nodeType&&"string"==typeof e.nodeName}function createElement(e,n){for(var t=arguments.length,r=Array(t>2?t-2:0),i=2;i<t;i++)r[i-2]=arguments[i];var o=null==n?{}:n;return tagType(ELEMENT,{tagName:e,attributes:o,children:r})}function bind(e){var n=isArray(e)?e:[e];return tagType(BINDING,{address:n})}function explicitNamespace(e){var n=e.indexOf(":");if(n!==-1){var t=e.slice(0,n);if(t in NAMESPACES){var r="xmlns"===t?e:e.slice(n+1);return{name:r,explicit:NAMESPACES[t]}}return{name:e,explicit:null}}return{name:e,explicit:null}}function createDOMElement(e,n){var t=e.tagName,r=explicitNamespace(t),i=r.name,o=r.explicit,a=null!==o?o:t in NAMESPACES?NAMESPACES[t]:n.namespaceURI,l=a===NAMESPACES.xhtml?document.createElement(i):document.createElementNS(a,i);return updateDOMElement(l,e)}function getStyles(e){for(var n=/([^:; ]+):/g,t=[],r=void 0;null!==(r=n.exec(e));)t.push(r[1]);return t}function toCamelCase(e){return e.replace(/-(.)/g,function(e){return e.toUpperCase()}).replace(/-/g,"")}function stripOn(e){return e.slice(2).toLowerCase()}function setAttributeCheckBool(e,n,t,r){var i=r===!0?t:r;e===NAMESPACES.xhtml?n.setAttribute(t,i):n.setAttributeNS(e,t,i)}function updateDOMElement(e,n){var t=null,r=e.namespaceURI;e.hasOwnProperty(LISTENER_OBJECT)&&(mapValues(e[LISTENER_OBJECT],function(n,t){e.removeEventListener(t,n)}),delete e[LISTENER_OBJECT]),mapValues(n.attributes,function(i,o){if("id"===o)e.id=i;else if("style"!==o||isString(i))if(0===o.indexOf("on")){if(e.hasOwnProperty(LISTENER_OBJECT)||(e[LISTENER_OBJECT]={}),null!==i){var a=stripOn(o);if(!isFunction(i)&&null!==i)throw new Error(i+" is not a function.");e[LISTENER_OBJECT][a]=i,e.addEventListener(a,i)}}else if(o in ATTRIBUTE_RENAME){var l=explicitNamespace(o),u=(l.name,l.explicit);setAttributeCheckBool(null!==u?u:r,e,ATTRIBUTE_RENAME[u],i)}else if(o in ATTRIBUTE_APPLY)ATTRIBUTE_APPLY[o](e,n.tagName,i);else if("then"===o){if(null!==i){if(!isFunction(i))throw new Error(i+" is not a function or null.");t=i}}else{var s=explicitNamespace(o),c=s.name,d=s.explicit;setAttributeCheckBool(null!==d?d:r,e,c,i)}else mapValues(i,function(n,t){e.style.setProperty(t,n)})});for(var i=[],o=0,a=e.attributes.length;o<a;o++)i.push(e.attributes[o].name);i.filter(function(e){return!(e in n.attributes)||n.attributes[e]===!1}).map(function(t){t in ATTRIBUTE_RENAME_REV?e.removeAttribute(ATTRIBUTE_RENAME_REV[t]):t in ATTRIBUTE_APPLY?ATTRIBUTE_APPLY[t](e,n.tagName):e.removeAttribute(t)});var l=n.attributes.style;return l&&!isString(l)&&getStyles(e.style.cssText).filter(function(e){return!(e in l||toCamelCase(e)in l)}).map(function(n){return e.style.removeProperty(n)}),t&&defer(function(){return t(e)}),e}function flattenElementsAr(e){return e.reduce(function(e,n){return isArray(n)?[].concat(e,n):[].concat(e,[n])},[]).filter(notNull)}function removeExtraNodes(e,n){for(var t=e.childNodes.length-1;t>=n;t--)e.removeChild(e.childNodes[t])}function render(e){if(!isElement(e))throw new Error("First argument must be a DOM Element.");for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];var i=flattenElementsAr(t),o=get(i,0);if(isTinierBinding(o)){if(1!==i.length)throw new Error("A binding cannot have siblings in TinierDOM. At binding: [ "+o.address.join(", ")+" ].");return objectForBindings([addressToObj(o.address,e)])}var a=Array.from(e.children).filter(function(e){return e.id}),l=keyBy(a,"id"),u=i.map(function(n,t){if(isUndefined(n))throw new Error("Children in Tinier Elements cannot be undefined.");if(isTinierElement(n)){var r=e.childNodes[t];if(n.attributes.id in l){var i=l[n.attributes.id];return r?e.replaceChild(i,r):e.appendChild(i),render.apply(void 0,[i].concat(n.children))}if(r){if(r.tagName&&r.tagName.toLowerCase()===n.tagName.toLowerCase()){var o=r.id?r.cloneNode(!0):r;return updateDOMElement(o,n),r.id&&e.replaceChild(o,r),render.apply(void 0,[o].concat(n.children))}var a=createDOMElement(n,e);return e.replaceChild(a,r),render.apply(void 0,[a].concat(n.children))}var u=createDOMElement(n,e);return e.appendChild(u),render.apply(void 0,[u].concat(n.children))}if(isTinierBinding(n))throw new Error("A binding cannot have siblings in TinierDOM. At binding: [ "+n.address.join(", ")+" ].");var s=e.childNodes[t],c=String(n);return isText(s)?s.textContent=c:s?e.replaceChild(document.createTextNode(c),s):e.appendChild(document.createTextNode(c)),null});return removeExtraNodes(e,i.length),objectForBindings(u.filter(function(e){return null!==e}))}exports.__esModule=!0;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_extends=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e};exports.tail=tail,exports.head=head,exports.fromPairs=fromPairs,exports.get=get,exports.isUndefined=isUndefined,exports.isObject=isObject,exports.isArray=isArray,exports.isString=isString,exports.isNumber=isNumber,exports.isBoolean=isBoolean,exports.isFunction=isFunction,exports.notNull=notNull,exports.mapValues=mapValues,exports.reduceValues=reduceValues,exports.zipArrays=zipArrays,exports.zipObjects=zipObjects,exports.filterValues=filterValues,exports.any=any,exports.tagType=tagType,exports.checkType=checkType,exports.match=match,exports.hasChildren=hasChildren,exports.checkRenderResult=checkRenderResult,exports.updateEl=updateEl,exports.addressWith=addressWith,exports.addressEqual=addressEqual,exports.makeTree=makeTree,exports.checkState=checkState,exports.diffWithModelMin=diffWithModelMin,exports.makeSignal=makeSignal,exports.makeOneSignalAPI=makeOneSignalAPI,exports.makeChildSignalsAPI=makeChildSignalsAPI,exports.reduceChildren=reduceChildren,exports.mergeSignals=mergeSignals,exports.objectOf=objectOf,exports.arrayOf=arrayOf,exports.createComponent=createComponent,exports.patchMethods=patchMethods,exports.makeCallMethod=makeCallMethod,exports.makeCallReducer=makeCallReducer,exports.makeStateCallers=makeStateCallers,exports.run=run,exports.addressToObj=addressToObj,exports.objectForBindings=objectForBindings,exports.createElement=createElement,exports.bind=bind,exports.createDOMElement=createDOMElement,exports.getStyles=getStyles,exports.updateDOMElement=updateDOMElement,exports.render=render;var ARRAY_OF=exports.ARRAY_OF="@TINIER_ARRAY_OF",OBJECT_OF=exports.OBJECT_OF="@TINIER_OBJECT_OF",COMPONENT=exports.COMPONENT="@TINIER_COMPONENT",ARRAY=exports.ARRAY="@TINIER_ARRAY",OBJECT=exports.OBJECT="@TINIER_OBJECT",NODE=exports.NODE="@TINIER_NODE",NULL=exports.NULL="@TINIER_NULL",STRING=exports.STRING="@TINIER_STRING",NUMBER=exports.NUMBER="@TINIER_NUMBER",BOOLEAN=exports.BOOLEAN="@TINIER_BOOLEAN",ANY=exports.ANY="@TINIER_ANY",NO_ARGUMENT=exports.NO_ARGUMENT="@TINIER_NO_ARGUMENT",TOP=exports.TOP="@TINIER_TOP",CREATE=exports.CREATE="@TINIER_CREATE",UPDATE=exports.UPDATE="@TINIER_UPDATE",DESTROY=exports.DESTROY="@TINIER_DESTROY",BINDING=exports.BINDING="@TINIER_BINDING",ELEMENT=exports.ELEMENT="@TINIER_ELEMENT",LISTENER_OBJECT="@TINIER_LISTENERS",ATTRIBUTE_RENAME={},ATTRIBUTE_RENAME_REV=reverseObject(ATTRIBUTE_RENAME),ATTRIBUTE_APPLY={checked:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("input"!==n)throw new Error('"checked" attribute is only supported on input elements.');e.checked=t},value:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(["input","textarea"].indexOf(n)===-1)throw new Error('"value" attribute is only supported on input and textarea elements.');e.value=t}},NAMESPACES={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},isTinierBinding=function(e){return checkType(BINDING,e)},isTinierElement=function(e){return checkType(ELEMENT,e)};exports.default={arrayOf:arrayOf,objectOf:objectOf,createComponent:createComponent,run:run,bind:bind,createElement:createElement,render:render};
//# sourceMappingURL=lib/tinier.min.js.map